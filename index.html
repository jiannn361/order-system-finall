<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>é»é¤ç³»çµ±</title>
    
    <!-- è¼‰å…¥ React æ ¸å¿ƒ (CDN) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    
    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        body { -webkit-tap-highlight-color: transparent; font-family: -apple-system, system-ui, sans-serif; background-color: #f8fafc; }
        #loading { position: fixed; inset: 0; background: #fff; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #ea580c; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .animate-slide-up { animation: slideUp 0.3s ease-out forwards; }
        .animate-fade-in { animation: fadeIn 0.2s ease-out forwards; }
    </style>
</head>
<body class="text-gray-800 antialiased">

    <div id="loading">
        <div class="spinner"></div>
        <div class="mt-4 text-lg font-bold text-gray-600" id="loading-text">é€£ç·šè‡³è³‡æ–™åº«ä¸­...</div>
        <div id="loading-msg" class="text-xs text-red-500 mt-2 px-6 text-center"></div>
        <button onclick="window.location.reload()" class="mt-4 text-xs text-gray-400 underline">é‡æ–°æ•´ç†</button>
    </div>

    <div id="root" style="display:none;"></div>

    <!-- æ•æ‰è‡´å‘½éŒ¯èª¤ï¼Œé˜²æ­¢ç™½ç•«é¢æ­»ç•¶ -->
    <script>
        window.onerror = function(msg) {
            var loader = document.getElementById('loading-msg');
            if(loader) loader.innerText = "ç³»çµ±é‡åˆ°å°éšœç¤™ï¼š" + msg;
        };
    </script>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        
        // å…§å»ºåœ–ç¤º
        const Icon = ({ name, size=20, className="" }) => {
            const icons = {
                Clock: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
                Settings: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
                Volume2: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>,
                LayoutGrid: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg>,
                Package: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m7.5 4.27 9 5.15"/><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></svg>,
                Coffee: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M10 2v2"/><path d="M14 2v2"/><path d="M6 2v2"/><path d="M18 8a4 4 0 0 1 4 4 4 4 0 0 1-4 4h-4.06a4 4 0 0 1-3.75-2.71L10 13a4 4 0 0 1-3.75-2.71L6 10a4 4 0 0 1 4-4h4Z"/><path d="M2 18h20v2a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-2Z"/></svg>,
                Trash2: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>,
                ShoppingBag: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>,
                X: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M18 6 6 18"/><path d="m6 6 18 12"/></svg>
            };
            return icons[name] || null;
        };

        const App = () => {
            const [shopState, setShopState] = useState({ name: "é€£ç·šä¸­...", isOpen: false, notices: [] });
            const [menuData, setMenuData] = useState({ combos: [], items: [] });
            const [cart, setCart] = useState([]);
            
            const [activeCategory, setActiveCategory] = useState('all');
            const [selectedItem, setSelectedItem] = useState(null);
            const [showCart, setShowCart] = useState(false); 
            const [adminStep, setAdminStep] = useState(0); 
            const [inputPwd, setInputPwd] = useState('');
            const [isUpdating, setIsUpdating] = useState(false);
            const [globalNote, setGlobalNote] = useState('');
            
            // æ—¥æœŸèˆ‡æ™‚é–“é è¨­å€¼
            const tzOffset = (new Date()).getTimezoneOffset() * 60000; 
            const localISODate = (new Date(Date.now() - tzOffset)).toISOString().slice(0, 10);
            const [pickupDate, setPickupDate] = useState(localISODate);
            const [pickupTime, setPickupTime] = useState('');

            // â˜…â˜…â˜… è¨­å®šå€ (å·²ç¶“å¹«æ‚¨å¡«å¥½) â˜…â˜…â˜…
            const LIFF_ID = "2008979082-w7Tz842F"; 
            const GAS_URL = "https://script.google.com/macros/s/AKfycbwllHK_C8XKGg25IsmhNVWgk-wrRO0ihBGlj0XEuhhUecGDL0aagVfDTY-bKpG7kpT5SA/exec"; 

            // åˆå§‹åŒ–èˆ‡æŠ“å–è³‡æ–™
            useEffect(() => {
                if (window.liff) {
                    liff.init({ liffId: LIFF_ID }).then(() => {
                        if (!liff.isLoggedIn() && liff.isInClient()) liff.login();
                    }).catch(e => console.error("LIFF Error", e));
                }

                // é€é Fetch æŠ“å– Google è©¦ç®—è¡¨è³‡æ–™
                fetch(GAS_URL + "?action=getMenu")
                    .then(res => res.json())
                    .then(data => {
                        if (data.status === "success") {
                            setShopState(data.shop);
                            setMenuData(data.menu);
                            // éš±è— Loading ç•«é¢
                            document.getElementById('loading').style.display = 'none';
                            document.getElementById('root').style.display = 'block';
                        } else {
                            document.getElementById('loading-msg').innerText = "è®€å–å¤±æ•—ï¼š" + JSON.stringify(data);
                        }
                    })
                    .catch(e => {
                        document.getElementById('loading-msg').innerText = "é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²å€æˆ–ç¶²è·¯ç‹€æ…‹ã€‚";
                    });
            }, []);

            const displayItems = useMemo(() => {
                const all = [...menuData.combos, ...menuData.items];
                if (activeCategory === 'all') return all;
                if (activeCategory === 'combo') return menuData.combos;
                if (activeCategory === 'single') return menuData.items;
                return all;
            }, [menuData, activeCategory]);

            // ç”¢ç”Ÿæ¼‚äº®å¡ç‰‡ (å·²ä¿®æ­£èªæ³•éŒ¯èª¤)
            const getFlexMessage = (cart, total, note, pDate, pTime) => {
                const itemsRows = cart.map(item => ({
                    type: "box", layout: "vertical", margin: "md",
                    contents: [
                        {
                            type: "box", layout: "horizontal",
                            contents: [
                                { type: "text", text: item.name, size: "md", weight: "bold", color: "#333333", flex: 6, wrap: true },
                                { type: "text", text: `x${item.quantity}`, size: "sm", color: "#666666", align: "center", flex: 2 },
                                { type: "text", text: `$${item.displayPrice}`, size: "sm", weight: "bold", color: "#ea580c", align: "end", flex: 3 }
                            ]
                        },
                        item.customs && { type: "text", text: `â”” ${item.customs}`, size: "xs", color: "#aaaaaa", wrap: true, margin: "none", offsetStart: "md" }
                    ].filter(Boolean)
                }));

                return {
                    type: "bubble",
                    body: {
                        type: "box", layout: "vertical",
                        contents: [
                            { type: "text", text: "è¨‚å–®ç¢ºèª", weight: "bold", color: "#1DB446", size: "sm" },
                            // âœ… é€™è£¡ä¿®æ­£äº†ï¼šè£œä¸Šäº† text: 
                            { type: "text", text: shopState.name, weight: "bold", size: "xl", margin: "md" },
                            { 
                                type: "box", layout: "vertical", margin: "md", backgroundColor: "#fff7ed", cornerRadius: "md", paddingAll: "md",
                                contents: [
                                    { type: "text", text: "ğŸ•’ é å®šå–é¤æ™‚é–“", size: "xs", color: "#ea580c", weight: "bold" },
                                    { type: "text", text: `${pDate} ${pTime}`, size: "lg", color: "#333333", weight: "bold", margin: "sm" }
                                ]
                            },
                            { type: "separator", margin: "lg" },
                            { type: "box", layout: "vertical", margin: "lg", contents: itemsRows },
                            { type: "separator", margin: "lg", color: "#e5e7eb" },
                            {
                                type: "box", layout: "horizontal", margin: "lg",
                                contents: [
                                    { type: "text", text: "ç¸½è¨ˆ", size: "md", color: "#6b7280", weight: "bold", gravity: "bottom" },
                                    { type: "text", text: `$${total}`, size: "2xl", color: "#ea580c", align: "end", weight: "bold" }
                                ]
                            },
                            note ? { type: "text", text: `å‚™è¨»ï¼š${note}`, size: "xs", color: "#ea580c", margin: "md" } : { type: "spacer" }
                        ]
                    }
                };
            };

            // é€å‡ºè¨‚å–®
            const submitOrder = async () => {
                if (cart.length === 0) return;
                
                if (!pickupDate || !pickupTime) { 
                    alert("âŒ è«‹é¸æ“‡ã€Œé å®šå–é¤çš„æ—¥æœŸèˆ‡æ™‚é–“ã€ï¼"); 
                    return; 
                }

                const btn = document.getElementById("submit-btn");
                if(btn) { btn.innerText = "è™•ç†ä¸­..."; btn.disabled = true; }

                const total = cart.reduce((s, i) => s + i.displayPrice, 0);
                const flexMsg = getFlexMessage(cart, total, globalNote, pickupDate, pickupTime);
                
                const clientTime = new Date().toLocaleString('zh-TW', { timeZone: 'Asia/Taipei', hour12: false });
                let textMsg = `ğŸ“‹ æ–°è¨‚å–® ${clientTime}\nğŸ•’ å–é¤ï¼š${pickupDate} ${pickupTime}\n----------------\n`;
                cart.forEach(i => textMsg += `${i.name} x${i.quantity} ${i.customs ? '('+i.customs+')' : ''}\n`);
                textMsg += `----------------\nğŸ’° ç¸½è¨ˆï¼š$${total}`;
                if(globalNote) textMsg += `\nå‚™è¨»ï¼š${globalNote}`;

                try {
                    // 1. é€åˆ° Google å¾Œå°
                    const backendNote = `[å–é¤:${pickupDate} ${pickupTime}] ${globalNote}`;
                    fetch(GAS_URL, { 
                        method: 'POST', 
                        mode: 'no-cors', 
                        body: JSON.stringify({ cart, total, globalNote: backendNote, action:"submit" }) 
                    }).catch(e => console.log("GAS Error", e));
                    
                    // 2. å‚³é€ LINE
                    let sent = false;
                    if (window.liff && liff.isInClient()) {
                        try {
                            await liff.sendMessages([{ type: 'flex', altText: `è¨‚å–® $${total}`, contents: flexMsg }]);
                            sent = true;
                            liff.closeWindow();
                        } catch (err) {
                            if (liff.isApiAvailable('shareTargetPicker')) {
                                const res = await liff.shareTargetPicker([{ type: 'flex', altText: `è¨‚å–® $${total}`, contents: flexMsg }]);
                                if(res) {
                                    sent = true;
                                    liff.closeWindow();
                                }
                            }
                        }
                    }

                    if (!sent) {
                        alert("è¨‚å–®å·²å»ºç«‹ï¼\nè«‹é»æ“Šã€Œç¢ºå®šã€å‚³é€çµ¦åº—å®¶ã€‚");
                        window.location.href = "https://line.me/R/msg/text/?" + encodeURIComponent(textMsg);
                    }
                } catch(e) {
                    window.location.href = "https://line.me/R/msg/text/?" + encodeURIComponent(textMsg);
                } finally {
                    setTimeout(() => {
                        if(btn) { btn.innerText = "é€å‡ºè¨‚å–®"; btn.disabled = false; }
                        setCart([]); setShowCart(false);
                    }, 1000);
                }
            };

            const toggleStatus = async (status) => {
                setIsUpdating(true);
                try {
                    await fetch(GAS_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ action: "updateStatus", password: inputPwd, status: status }) });
                    setShopState(prev => ({ ...prev, isOpen: (status === 'Y') }));
                    alert("ç‹€æ…‹æ›´æ–°æŒ‡ä»¤å·²ç™¼é€ï¼\nè«‹é‡æ–°æ•´ç†é é¢ç¢ºèªã€‚");
                    setAdminStep(0);
                } catch(e) { alert("é€£ç·šéŒ¯èª¤"); }
                setIsUpdating(false);
            };

            const removeFromCart = (index) => {
                const newCart = cart.filter((_, i) => i !== index);
                setCart(newCart);
                if (newCart.length === 0) setShowCart(false);
            };

            const addToCart = () => {
                if (selectedItem.type === 'å¥—é¤') {
                    if(!selectedItem.main) { alert("âŒ è«‹é¸æ“‡ä¸»é£Ÿ"); return; }
                    if(!selectedItem.soup) { alert("âŒ è«‹é¸æ“‡æ¹¯å“"); return; }
                }
                const addonPrice = (selectedItem.addons || []).length * 10;
                const totalP = (selectedItem.basePrice + addonPrice) * selectedItem.quantity;
                const customs = [
                    selectedItem.main ? `ä¸»é£Ÿ:${selectedItem.main}` : '',
                    selectedItem.soup ? `æ¹¯å“:${selectedItem.soup}` : '',
                    selectedItem.spicy,
                    ...(selectedItem.addons || []),
                    selectedItem.itemNote ? `å‚™è¨»:${selectedItem.itemNote}` : ''
                ].filter(Boolean);
                setCart([...cart, { ...selectedItem, displayPrice: totalP, customs: customs.join(' / ') }]);
                setSelectedItem(null);
            };
            const showExtras = selectedItem && (selectedItem.type === 'å¥—é¤' || selectedItem.name.includes('é£¯') || selectedItem.name.includes('éºµ'));

            return (
                <div className="max-w-md mx-auto min-h-screen pb-32 bg-white relative">
                    {/* 1. æ¨™é¡Œèˆ‡ç‡Ÿæ¥­ç‹€æ…‹æ”¹ç‚ºç½®ä¸­ */}
                    <header className="sticky top-0 z-30 bg-white/80 backdrop-blur-md border-b border-gray-100 px-6 pt-10 pb-4 flex justify-center items-center relative">
                        <div className="flex flex-col items-center">
                            <span className={`text-[10px] font-bold uppercase tracking-widest mb-1 flex items-center justify-center gap-1 ${shopState.isOpen ? 'text-green-600' : 'text-red-500'}`}>
                                <Icon name="Clock" size={12}/> {shopState.isOpen ? 'ç‡Ÿæ¥­ä¸­' : 'ä¼‘æ¯ä¸­'}
                            </span>
                            <h1 className="text-2xl font-black text-gray-900 text-center">{shopState.name}</h1>
                        </div>
                        <button onClick={() => setAdminStep(1)} className="absolute right-6 bottom-4 w-10 h-10 bg-gray-50 rounded-full flex items-center justify-center text-gray-400 hover:text-gray-700 hover:bg-gray-100 transition-colors border border-gray-200"><Icon name="Settings" /></button>
                    </header>

                    {/* è¨‚é¤é ˆçŸ¥å€å¡Š (å›ºå®šé¡¯ç¤º) */}
                    <div className="mx-5 mt-5 mb-2 p-5 bg-orange-50 rounded-2xl border border-orange-100 shadow-sm">
                        <div className="flex items-center gap-2 mb-2 text-orange-600">
                            <Icon name="Volume2" size={18}/>
                            <h2 className="font-black text-base">è¨‚é¤é ˆçŸ¥</h2>
                        </div>
                        <div className="text-sm text-orange-800 font-medium leading-relaxed space-y-1">
                            {shopState.notices && shopState.notices.length > 0 && shopState.notices.join('').trim() !== ''
                                ? shopState.notices.map((n, i) => n.trim() ? <div key={i}>â€¢ {n.trim()}</div> : null)
                                : <div>â€¢ åƒ…æä¾›ç¾é‡‘æ”¯ä»˜ï¼Œå–è²¨æ™‚ä»˜æ¬¾|è‡ªå–åœ°é»:äº¬å“èŒ¶èˆ‡å’–å•¡è¾²å ´</div>
                            }
                        </div>
                    </div>

                    {/* 2. åˆ†é¡æŒ‰éˆ•æ”¹ç‚ºç½®ä¸­ (åŠ å…¥ justify-center) */}
                    <div className="px-5 my-6 sticky top-[92px] z-20 flex justify-center gap-3 overflow-x-auto no-scrollbar pb-2">
                        {[
                            {id:'all', label:'å…¨éƒ¨', icon:'LayoutGrid'},
                            {id:'combo', label:'å¥—é¤', icon:'Package'},
                            {id:'single', label:'å–®é»', icon:'Coffee'}
                        ].map(tab => (
                            <button key={tab.id} onClick={() => setActiveCategory(tab.id)} 
                                className={`flex items-center gap-2 px-5 py-3 rounded-2xl font-bold text-sm transition-all shadow-sm ${activeCategory===tab.id ? 'bg-orange-600 text-white scale-105' : 'bg-white text-gray-500 border border-gray-100'}`}>
                                <Icon name={tab.icon} size={18}/> {tab.label}
                            </button>
                        ))}
                    </div>

                    <div className="px-5 space-y-4">
                        {displayItems.map(item => (
                            <div key={item.id} onClick={()=>setSelectedItem({...item, quantity:1, basePrice:item.price, addons:[], spicy:'ä¸è¾£', main:'', soup:'', itemNote:''})} 
                                 className="bg-white rounded-[24px] p-5 shadow-sm border border-gray-100 flex justify-between items-center active:scale-95 transition-transform">
                                <div className="flex-1 pr-4">
                                    <div className="flex items-center gap-2 mb-1">
                                        {item.type === 'å¥—é¤' && <span className="text-[10px] bg-amber-100 text-amber-700 px-2 py-0.5 rounded-md font-bold">å¥—é¤</span>}
                                        <h3 className="text-lg font-bold text-gray-900">{item.name}</h3>
                                    </div>
                                    <p className="text-sm text-gray-400 line-clamp-1">{item.info}</p>
                                </div>
                                <div className="text-orange-600 font-black text-2xl">${item.price}</div>
                            </div>
                        ))}
                    </div>

                    {cart.length > 0 && !showCart && !selectedItem && (
                        <div className="fixed bottom-6 left-0 right-0 flex justify-center z-40 px-5 animate-slide-up">
                            <div className="bg-gray-900/95 backdrop-blur-xl shadow-2xl rounded-full px-2 py-2 flex items-center justify-between w-full border border-gray-700">
                                <div className="flex items-center pl-4 cursor-pointer" onClick={() => setShowCart(true)}>
                                    <div className="w-10 h-10 bg-gray-800 rounded-full flex items-center justify-center text-white relative">
                                        <Icon name="ShoppingBag" size={20}/>
                                        <span className="absolute -top-1 -right-1 bg-rose-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full">{cart.length}</span>
                                    </div>
                                    <div className="ml-4 text-xl font-bold text-white">${cart.reduce((s,i)=>s+i.displayPrice, 0)}</div>
                                </div>
                                <button onClick={() => setShowCart(true)} className="px-8 py-3.5 rounded-full font-bold text-sm text-white bg-orange-600 shadow-lg active:scale-95 transition-all">å»çµå¸³</button>
                            </div>
                        </div>
                    )}

                    {selectedItem && (
                        <div className="fixed inset-0 z-50 flex flex-col justify-end animate-fade-in">
                            <div className="absolute inset-0 bg-gray-900/40 backdrop-blur-sm" onClick={()=>setSelectedItem(null)}></div>
                            <div className="relative bg-white w-full rounded-t-[32px] shadow-2xl max-h-[90vh] flex flex-col animate-slide-up">
                                <div className="p-6 flex justify-between items-center border-b border-gray-100">
                                    <div><h3 className="text-2xl font-black text-gray-900">{selectedItem.name}</h3><div className="text-orange-600 font-bold text-xl">${selectedItem.basePrice}</div></div>
                                    <button onClick={()=>setSelectedItem(null)} className="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-gray-500"><Icon name="X" size={18}/></button>
                                </div>
                                <div className="p-6 overflow-y-auto no-scrollbar space-y-6 flex-1">
                                    {selectedItem.type === "å¥—é¤" && (
                                        <>
                                            <div className="grid grid-cols-2 gap-3"><p className="col-span-2 text-sm font-bold">ä¸»é£Ÿ</p>{selectedItem.mainOptions.map(m=><button key={m} onClick={()=>setSelectedItem({...selectedItem, main:m})} className={`py-3 rounded-xl border-2 text-sm font-bold ${selectedItem.main===m?'border-orange-500 bg-orange-50 text-orange-700':'border-transparent bg-gray-50'}`}>{m}</button>)}</div>
                                            <div className="grid grid-cols-2 gap-3"><p className="col-span-2 text-sm font-bold">æ¹¯å“</p>{selectedItem.soupOptions.map(s=><button key={s} onClick={()=>setSelectedItem({...selectedItem, soup:s})} className={`py-3 rounded-xl border-2 text-sm font-bold ${selectedItem.soup===s?'border-orange-500 bg-orange-50 text-orange-700':'border-transparent bg-gray-50'}`}>{s}</button>)}</div>
                                        </>
                                    )}
                                    
                                    {/* 3. è¾£åº¦èˆ‡åŠ è³¼é¸é …æ”¹ç‚ºæ¼‚äº®çš„æ©«åˆ—æ’ç‰ˆ */}
                                    {showExtras && (
                                        <div className="space-y-4">
                                            <div className="flex items-center gap-3">
                                                <div className="text-sm font-bold text-gray-500 w-10 shrink-0">è¾£åº¦</div>
                                                <div className="flex flex-1 gap-2">
                                                    {['ä¸è¾£','å°è¾£','å¤§è¾£'].map(s=><button key={s} onClick={()=>setSelectedItem({...selectedItem, spicy:s})} className={`flex-1 py-2.5 rounded-xl border-2 text-sm font-bold transition-all ${selectedItem.spicy===s?'border-orange-500 bg-orange-50 text-orange-700':'border-transparent bg-gray-50 text-gray-600'}`}>{s}</button>)}
                                                </div>
                                            </div>
                                            <div className="flex items-center gap-3">
                                                <div className="text-sm font-bold text-gray-500 w-10 shrink-0">åŠ è³¼</div>
                                                <div className="flex flex-1 gap-2">
                                                    <button onClick={()=>{const t=selectedItem.name.includes('éºµ')?'åŠ éºµ':'åŠ é£¯';const h=selectedItem.addons.includes(t);setSelectedItem({...selectedItem, addons:h?selectedItem.addons.filter(a=>a!==t):[...selectedItem.addons,t]})}} className={`flex-1 py-2.5 rounded-xl border-2 text-sm font-bold transition-all ${selectedItem.addons.includes(selectedItem.name.includes('éºµ')?'åŠ éºµ':'åŠ é£¯')?'border-gray-800 bg-gray-800 text-white':'border-transparent bg-gray-50 text-gray-600'}`}>{selectedItem.name.includes('éºµ')?'åŠ éºµ':'åŠ é£¯'}</button>
                                                    <button onClick={()=>{const h=selectedItem.addons.includes('åŠ èœ');setSelectedItem({...selectedItem, addons:h?selectedItem.addons.filter(a=>a!=='åŠ èœ'):[...selectedItem.addons,'åŠ èœ']})}} className={`flex-1 py-2.5 rounded-xl border-2 text-sm font-bold transition-all ${selectedItem.addons.includes('åŠ èœ')?'border-gray-800 bg-gray-800 text-white':'border-transparent bg-gray-50 text-gray-600'}`}>åŠ èœ</button>
                                                </div>
                                            </div>
                                        </div>
                                    )}

                                    <textarea placeholder="å‚™è¨»..." className="w-full p-4 bg-gray-50 rounded-xl text-sm outline-none border border-gray-200" rows="2" value={selectedItem.itemNote||''} onChange={e=>setSelectedItem({...selectedItem, itemNote:e.target.value})} />
                                </div>
                                <div className="p-5 border-t border-gray-100">
                                    <button onClick={addToCart} className="w-full py-4 bg-orange-600 text-white rounded-full font-bold text-lg shadow-lg active:scale-95">åŠ å…¥è³¼ç‰©è»Š</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {showCart && (
                        <div className="fixed inset-0 z-[60] flex flex-col justify-end animate-fade-in">
                            <div className="absolute inset-0 bg-gray-900/60 backdrop-blur-sm" onClick={() => setShowCart(false)}></div>
                            <div className="relative bg-gray-50 w-full rounded-t-[32px] shadow-2xl max-h-[95vh] flex flex-col animate-slide-up">
                                <div className="bg-white rounded-t-[32px] px-6 py-5 flex justify-between items-center border-b border-gray-100">
                                    <h3 className="font-black text-2xl text-gray-900">çµå¸³ç¢ºèª</h3>
                                    <button onClick={() => setShowCart(false)} className="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-gray-500"><Icon name="X" size={18}/></button>
                                </div>
                                <div className="p-5 overflow-y-auto no-scrollbar space-y-4 flex-1">
                                    <div className="bg-white rounded-[24px] p-2 shadow-sm border border-gray-100">
                                        {cart.map((item, idx) => (
                                            <div key={idx} className="flex justify-between items-center p-4 border-b border-gray-50 last:border-0">
                                                <div className="flex-1"><div className="font-bold text-gray-900">{item.name} x{item.quantity}</div><div className="text-xs text-gray-400">{item.customs}</div><div className="text-orange-600 font-bold">${item.displayPrice}</div></div>
                                                <button onClick={() => {const n=cart.filter((_,i)=>i!==idx); setCart(n); if(n.length===0) setShowCart(false);}} className="w-10 h-10 ml-3 bg-rose-50 text-rose-500 rounded-full flex items-center justify-center"><Icon name="Trash2" size={16}/></button>
                                            </div>
                                        ))}
                                    </div>
                                    <div className="bg-white rounded-[24px] p-5 shadow-sm border border-gray-100 space-y-5">
                                        <div>
                                            <p className="text-[10px] font-bold text-gray-400 mb-2 uppercase">é å®šå–é¤æ™‚é–“ <span className="text-red-500">*</span></p>
                                            <div className="flex gap-3">
                                                <input type="date" className="flex-1 p-3 bg-gray-50 rounded-xl text-sm border outline-none font-bold text-gray-700" value={pickupDate} onChange={e=>setPickupDate(e.target.value)} />
                                                <input type="time" className="flex-1 p-3 bg-gray-50 rounded-xl text-sm border outline-none font-bold text-gray-700" value={pickupTime} onChange={e=>setPickupTime(e.target.value)} />
                                            </div>
                                        </div>
                                        <hr className="border-gray-100" />
                                        <div>
                                            <p className="text-[10px] font-bold text-gray-400 mb-2 uppercase">æ•´å–®å‚™è¨»</p>
                                            <textarea className="w-full p-4 bg-gray-50 rounded-xl text-sm border outline-none" placeholder="è¼¸å…¥éœ€æ±‚..." value={globalNote} onChange={e=>setGlobalNote(e.target.value)} />
                                        </div>
                                    </div>
                                </div>
                                <div className="bg-white p-6 pb-8 rounded-t-3xl shadow-lg border-t border-gray-100">
                                    <div className="flex justify-between items-center mb-4 px-2"><span className="font-bold text-gray-500">ç¸½è¨ˆ</span><span className="text-3xl font-black text-orange-600">${cart.reduce((s,i)=>s+i.displayPrice, 0)}</span></div>
                                    <button id="submit-btn" onClick={submitOrder} disabled={!shopState.isOpen} className={`w-full py-4 rounded-full font-bold text-lg text-white shadow-lg active:scale-95 ${shopState.isOpen?'bg-gray-900':'bg-gray-300'}`}>
                                        {shopState.isOpen ? 'ç¢ºèªé€å‡º' : 'ä¼‘æ¯ä¸­'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {adminStep > 0 && (
                        <div className="fixed inset-0 z-[70] flex items-center justify-center p-6 bg-gray-900/60 backdrop-blur-sm" onClick={() => setAdminStep(0)}>
                            <div className="bg-white w-full max-w-sm rounded-[32px] p-8 text-center space-y-6 shadow-2xl" onClick={e=>e.stopPropagation()}>
                                <h2 className="font-black text-2xl text-gray-900">å¾Œå°ç®¡ç†</h2>
                                {isUpdating ? (
                                    <div className="py-8 space-y-4 text-orange-600 font-bold">
                                        <div className="animate-spin text-4xl inline-block">âš™ï¸</div>
                                        <p>è³‡æ–™æ›´æ–°ä¸­...</p>
                                    </div>
                                ) : adminStep === 1 ? (
                                    <div className="space-y-4">
                                        <input type="password" placeholder="å¯†ç¢¼" className="w-full p-4 bg-gray-50 rounded-xl text-center text-lg outline-none border" value={inputPwd} onChange={e=>setInputPwd(e.target.value)} />
                                        <button onClick={()=>setAdminStep(2)} className="w-full py-4 bg-gray-900 text-white rounded-xl font-bold text-lg">ç™»å…¥</button>
                                    </div>
                                ) : (
                                    <div className="space-y-3">
                                        <button onClick={()=>toggleStatus('Y')} className="w-full py-4 bg-emerald-50 text-emerald-700 font-bold rounded-xl border border-emerald-200">é–‹å•Ÿç‡Ÿæ¥­</button>
                                        <button onClick={()=>toggleStatus('N')} className="w-full py-4 bg-rose-50 text-rose-700 font-bold rounded-xl border border-rose-200">é—œé–‰ç‡Ÿæ¥­</button>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
